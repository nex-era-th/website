<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>New Receipt</title>
  <script src="conf.js"></script>
  <script src="/js/xdev-b.js"></script>
  <link href="/js/w3.css" rel="stylesheet" type="text/css">
  <link href="/js/material-x.css" rel="stylesheet" type="text/css">

<style>
  *,
  *::before,
  *::after { box-sizing: border-box; }
  html { font-size: 16px; }
  small { font-size: 0.8rem }
  label { font-size: 1.0rem }
  .medium { font-size: 1.0rem }
  .default { font-size: 1.25rem }
  .large { font-size: 1.5rem }
  .xlarge { font-size: 2.0rem }

  .world-space { max-width: 800px; margin: auto; }
  .my-form > input {
    width: 100%; padding: 4px;
  }
  .my-form input,
  .my-form textarea,
  .my-form select,
  .my-form option {
    font-size: 1.25rem;
  }

  .line-in-form {
   grid-column: span 2; width: 100%; border-top: 1px solid gray; margin: 16px 0;
  }

  .hover-it:hover { background-color: #b2ebf2;}


  .product-item-box { 
    display: grid; 
    grid-template-columns: 30% 70%; 
    align-items: center; 
    width: 95%; 
    background-color: #eeeeee; 
    padding: 8px; 
    gap: 8px; 
    margin-left: auto;
  }


  #productGrid { background-color: white; }
  #productGrid > * { background-color: #eeeeee; width: 100%; height: 100%; padding: 8px } 

  .tcenter { text-align: center; }

</style>
<body>

<div style="padding: 0 16px; color: blue; background-color: white; z-index: 50; font-size: 1.5rem; font-style: bold">ออกใบเสร็จรับเงิน/ใบกำกับภาษี</div>


<div class="world-space" style="padding: 0 16px; margin-top: 32px">

  <!-- search box -->
  <div style="display: grid; grid-template-columns: 80% 20%; align-items: center; padding: 0 16px;">
    <input type="text" style="width: 100%; border-radius: 10px 0 0 10px; font-size: 1.2rem;" class="w3-input w3-border" placeholder="ค้นหา Partner/ลูกค้า ...">
    <button class="w3-button w3-blue" 
    style="border-radius: 0 10px 10px 0; padding: 11px 0"><img src="/icon-x/Search.svg" width="24"></button>
  </div>


  <!-- form -->
  <div class="my-form" id="newReceiptForm" style="display: grid; grid-template-columns: 30% 70%; align-items: center; gap: 4px; margin-top: 32px">

    <!--label>ภาพ</label>
    <div>
      <div style="cursor: pointer;" onclick="this.children[0].click()">
        <input type="file" id="picFile" hidden 
          onchange="xb.readPicFileAsDataUrl( this).then( durl => showPicHere.src = durl); showPicHere.hidden = false;">
        <div class="hover-it" style="display: inline-block; padding-right: 8px;">
          <img src="/icon-x/Image.svg" width="32">
          <small style="color: #5c6bc0">เลือกรูป</small>
        </div>
      </div>
      <img id="showPicHere" hidden
      style="width: 100%; object-fit: cover;">
    </div-->


    




    <label>ลูกค้า</label>
    <div class="medium">

      <div id="showPartnerHere" class="medium">ชื่อลูกค้า..............<br>
        address.................<br>
        ............<br>
        tel ..............<br>
        tax# ....................
      </div>

      <!-- add partner -->
      <div style="margin-top: 24px; cursor: pointer;" 
      onclick="location.href = 'add-partner.html';">
        <img src="/icon-x/Plus.svg" style="width: 24px; border-radius: 50%; background-color: #9fa8da;">
        <small style="font-size: 0.8rem; color: #9fa8da">เพิ่ม Partner ใหม่</small>
      </div>

    </div>

    
    <hr class="line-in-form">


    <label>ประเภทเอกสาร</label>
    <div>
      <input name="docType" type="checkbox" value="ใบเสร็จ" class="w3-check"> ใบเสร็จรับเงิน<br>
      <input name="docType" type="checkbox" value="ใบกำกับภาษี" class="w3-check"> ใบกำกับภาษี<br>
      <input name="docType" type="checkbox" value="ใบส่งของ" class="w3-check"> ใบส่งของ<br>
    </div>

    <hr class="line-in-form">

    <!-- find product -->
    <span style="grid-column: span 2; color: #5c6bc0; font-style: italic;">เลือกสินค้า</span>

    <div id="chooseProduct" style="grid-column: span 2; display: flex; flex-direction: column; gap: 30px">

      <div style="display: grid; grid-template-columns: 80% 20%; cursor: pointer;">
        <input type="text" class="w3-input w3-border" placeholder="ค้นหาสินค้า ...">
        <div style="display: flex; align-items: center; justify-content: center;"><img src="/icon-x/Search.svg" width="32"></div>
      </div>

      <div id="showProductHere">ชื่อสินค้า.............(รหัสสินค้า ....)<br>
      ราคา = 500.00 บาท/ชิ้น<br>
      </div>

      <div style="display: flex; align-items: center; justify-content: space-between;">

        <button class="w3-button w3-blue">เลือก</button>

        <div style="cursor: pointer;" 
        onclick="location.href = 'add-product.html';">
          <img src="/icon-x/Plus.svg" style="width: 24px; border-radius: 50%; background-color: #9fa8da;">
          <small style="font-size: 0.8rem; color: #9fa8da">เพิ่มสินค้าใหม่</small>
        </div>
      </div>

    </div>




    <hr class="line-in-form">


    <span style="grid-column: span 2; color: #5c6bc0; font-style: italic;">รายการสินค้าที่เลือก</span>

    <div id="productGrid" style="grid-column: span 2; display: grid; grid-template-columns: auto auto auto; align-items: center; gap: 1px;">

      <span class="tcenter">ลำดับ</span><span class="tcenter">สินค้า</span><span class="tcenter">ราคา</span>

      <span>1</span>
      <div style="display: flex; flex-wrap: wrap; flex-direction: column;">
        <span>Product XYZ sssssssssss (#2000)</span>
        <span>ราคา = 100.00 บาท/ชิ้น<br>
        <div>จำนวน <input type="number" style="width: 60px; font-size: 1.0rem; text-align: center;" value="1"> <span>ชิ้น</span></div>
          
      </div>
      <span>500000</span>

    </div>









    <hr class="line-in-form">



    <label>Note</label>
    <textarea id="note" rows="4" placeholder="Note ที่เรามีต่อเขา ..."></textarea>
    
    <label>ป้อนข้อมูลโดย*</label>
    <input id="enterBy" type="text" placeholder="เช่น @sern, @john ...">

  </div>

  <!-- form action -->
  <div style="display: flex; align-items: center; justify-content: space-around; margin-top: 40px; margin-bottom: 60px;">
    <button class="w3-button w3-blue" 
    onclick="addPartner()">Save</button>
    <button class="w3-button w3-light-grey" 
    onclick="location.reload()">Cancel / Clear</button>
  </div>



</div>



<!-- page action -->
<div style="padding: 4px; position: fixed; left: 0; bottom: 0; ">
  <img src="/icon/u-turn.svg" style="cursor: pointer; width: 32px;" 
  onclick="history.back()">
</div>


<script>
///////////////////////////////////////////////////////////////////


// this code scroll page to top after reload
window.onload = () => {
  setTimeout( () => {
    window.scrollTo(0,0)
  }, 10)
}



// DEFINITION

const domain = PUMP_DOMAIN //'http://192.168.1.111:4000';
const showPicHere = document.getElementById('showPicHere');


//const lastEdit = new Date
//document.getElementById('lastEdit').value = lastEdit





async function fetchThis( data, api ) {
    
  let response = await fetch( domain + api, {
    method  : 'POST',
    headers : {'Content-Type':'application/json'},
    body    : JSON.stringify( data )

  })
  
  return response.json()

}


async function addPartner() {
  try {
    let data = {
      pic: showPicHere.src,
      code: document.getElementById('code').value,
      name: document.getElementById('name').value,
      business: document.getElementById('business').value,

      tel: document.getElementById('tel').value,
      email: document.getElementById('email').value,
      web: document.getElementById('web').value,
      socialApp: document.getElementById('socialApp').value,

      registerType: document.getElementById('registerType').value,
      address: document.getElementById('address').value,
      registerCode: document.getElementById('registerCode').value,
      taxId: document.getElementById('taxId').value,  

      creditScore: document.getElementById('creditScore').value,
      
      bankAccount1: document.getElementById('bankAccount1').value,
      bankAccount2: document.getElementById('bankAccount2').value,

      financePerson: document.getElementById('financePerson').value,
      salesPerson: document.getElementById('salesPerson').value,
      servicesPerson: document.getElementById('servicesPerson').value,
      otherPerson: document.getElementById('otherPerson').value,

      note: document.getElementById('note').value,
      enterBy: document.getElementById('enterBy').value,
      time: Date.now()
    }


    // validate
    if( !data.name || !data.tel || !data.address || !data.taxId || !data.enterBy || data.registerType.startsWith('-')) {
      alert('ช่องที่มีเครื่องหมาย * ต้องมีข้อมูล')
      return
    }


    // pass - basic validation


    let reply = await fetchThis( data, '/add-partner' )
    //alert( JSON.stringify( resp ) )
    if (reply.done) {
      alert(`เรียบร้อย - Add Partner ชื่อ ${data.name} เรียบร้อยแล้ว`)
      location.reload()
    } else {
      alert(`ไม่สามารถ Save ข้อมูลได้ โปรดลองอีกครั้ง`)
    }
    

  
  } catch( error ) {
    console.error( error )
    alert('Error - มีปัญหาทางเทคนิค โปรดลองอีกครั้ง หรือหากยังมีปัญหา ติดต่อ @admin')
  }
}






</script>
</body>
</html>