<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Leaves</title>
  <script src="conf.js"></script>
  <script src="pump-b.js"></script>
  <link href="/js/w3.css" rel="stylesheet" type="text/css">
  <link href="/js/material-x.css" rel="stylesheet" type="text/css">
  <link href="pump.css" rel="stylesheet" type="text/css">
<style>
  /*
  *,
  *::before,
  *::after { box-sizing: border-box; }
  html { font-size: 16px; }
  th { text-align: center; }
  table {
    width: 100%; border-collapse: collapse; margin-top: 0px;
    border: 1px solid gray;
  }
  th, td {
    border: 1px solid gray; padding: 8px; text-align: left;
  }
  tr:hover { background-color: aqua; }

  .world-space { max-width: 800px; margin: auto; }
  */

  .main-grid {
    background-color: white;
  }
  .main-grid > * { 
    background-color: #eeeeee; padding: 12px 8px; height: 100%;
  }

  /*.tcenter { text-align: center; }*/



</style>
</head>
<body>

  <!--div style="padding: 0 16px; color: blue; background-color: white; z-index: 50; font-size: 1.5rem; font-style: bold">All Leaves</div-->


  <div class="world-space" style="padding: 0 16px; margin-top: 32px; margin-bottom: 60px;">

    <!-- title -->
    <div style="margin-bottom: 24px;">
      <div id="pageTitle" style="color: blue; background-color: white; z-index: 50; font-size: 1.5rem; font-style: bold">All Leaves</div>
      <p id="pageBrief" class="small">แสดงข้อมูลการลา ทั้งหมดของเดือนนี้</p>
    </div>


    <!-- find -->
    <div style="display: grid; grid-template-columns: 80% 20%; align-items: center;">
      <input type="text" style="width: 100%; border-radius: 10px 0 0 10px; font-size: 1.2rem;" class="w3-input w3-border" placeholder="ค้นจากวันหรือชื่อคน ...">
      <button class="w3-button w3-blue" 
      style="border-radius: 0 10px 10px 0; padding: 11px 0"><img src="/icon-x/Search.svg" width="24"></button>
    </div>


    <!-- grid -->
    <div class="main-grid" 
    style="margin-top: 32px; display: grid; grid-template-columns: auto auto auto; align-items: center; gap: 1px">

      <span class="tc">วันลา</span><span class="tc">พนักงาน</span><span class="tc">ประเภท</span>
      


    </div>




  </div>


  <!-- page action -->
  <div style="padding: 4px; position: fixed; left: 0; bottom: 0; ">
    <img src="/icon/u-turn.svg" style="width: 32px; cursor: pointer;" 
    onclick="location.href='/pump/index.html';">
  </div>
  








<script>
/////////////////////////////////////////////////////////////////

// GLOBAL VAR

const PGOJ = {};



// ON LOAD FUNC

window.onload = async () => {
  // get all product here

  try {

    let reply = await pumpb.fetchThis( 
      { masterKey: MASTER_KEY },
      '/get-all-leave'
    )
    
    if (reply.done) {
      reply.data.forEach( leave => {

        let time;
        if (leave.isLongLeave) {
          time = `${pumpb.simpleDate(leave.longLeave.fromDate)} - ${pumpb.simpleDate(leave.longLeave.toDate)} (${leave.longLeave.durationHours} ชม.)`
        } else {
          time = `${pumpb.simpleDate(leave.shortLeave.date)} ${leave.shortLeave.fromTime}-${leave.shortLeave.toTime} (${leave.shortLeave.durationHours} ชม.)`
        }
        
        let htmlCode = `<div data-id="${leave._id}">${time}</div><div data-id="${leave._id}">${leave.staffNickName}</div><div data-id="${leave._id}">${leave.leaveType}</div>`

        let gridEl = document.querySelector('.main-grid')
        gridEl.innerHTML = gridEl.innerHTML + htmlCode
        
      })

    } else {
      alert('ไม่มีข้อมูลอะไรเลยค่า')
    }

  } catch(er) {
    alert('มีปัญหาทางเทคนิคค่ะ')
  }

}


// LISTENING FUNC


// if user clicks on table bring her that payment info
document.querySelector('.main-grid').addEventListener('click', event => {

  //alert( event.target.dataset.id)
  //return

  location.href = 'leave-form.html?mode=view&id=' + event.target.dataset.id

})


</script>
</body>
</html>
