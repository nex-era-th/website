<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Partner</title>
  <script src="conf.js"></script>
  <script src="/js/xdev-b.js"></script>
  <link href="/js/w3.css" rel="stylesheet" type="text/css">
  <link href="/js/material-x.css" rel="stylesheet" type="text/css">

<style>
  *,
  *::before,
  *::after { box-sizing: border-box; }
  html { font-size: 16px; }
  small { font-size: 0.8rem }
  label { font-size: 1.0rem }
  .medium { font-size: 1.0rem }
  .default { font-size: 1.25rem }
  .large { font-size: 1.5rem }
  .xlarge { font-size: 2.0rem }

  .world-space { max-width: 800px; margin: auto; }
  .my-form > input {
    width: 100%; padding: 4px;
  }
  .my-form input,
  .my-form textarea,
  .my-form select,
  .my-form option {
    font-size: 1.25rem;
  }

  .line-in-form {
   grid-column: span 2; width: 100%; border-top: 1px solid gray; margin: 16px 0;
  }

  .hover-it:hover { background-color: #b2ebf2;}

</style>
<body>

<h3 style="padding: 16px; color: blue; background-color: white; position: sticky; top: 0; z-index: 50">ป้อนข้อมูล Partner</h3>


<div class="world-space" style="padding: 0 16px;">
  

  <div class="my-form" id="add_new_staff_form" style="display: grid; grid-template-columns: 30% 70%; align-items: center; gap: 4px">

    <label>ภาพ</label>
    <div>
      <div style="cursor: pointer;" onclick="this.children[0].click()">
        <input type="file" id="picFile" hidden 
          onchange="xb.readPicFileAsDataUrl( this).then( durl => showPicHere.src = durl); showPicHere.hidden = false;">
        <div class="hover-it" style="display: inline-block; padding-right: 8px;">
          <img src="/icon-x/Image.svg" width="32">
          <small style="color: #5c6bc0">เลือกรูป</small>
        </div>
      </div>
      <img id="showPicHere" hidden
      style="width: 100%; object-fit: cover;">
    </div>


    <label>Code</label>
    <input type="text" id="code">
    <label>ชื่อ*</label>
    <input type="text" id="name">  
    <label>งาน / ธุรกิจที่ทำ</label>
    <textarea id="business" rows="3" placeholder="เช่น ขนส่งน้ำมัน ..."></textarea>

    <hr class="line-in-form">
      
    <label>โทร</label>
    <input type="text" id="tel">  

    <label>Email</label>
    <input type="text" id="email">
    <label>Web</label>
    <input type="text" id="web">
    <label>Social App</label>
    <input type="text" id="socialApp">

    <hr class="line-in-form">



    <label>ประเภทองค์กร</label>
    <!--input type="text" id="department"-->
    <select id="registerType" class="w3-select">
      <option>-----</option>
      <option>นิติบุคคล</option>
      <option>บุคคลธรรมดา</option>
      <option>กลุ่มบุคคล</option>
      <option>อื่นๆ</option>
    </select>  

    
    <label>ที่อยู่</label>
    <textarea id="address" rows="3"></textarea>
    <label>เลขทะเบียน</label>
    <input type="text" id="registerCode">
    <label>เลขภาษี</label>
    <input type="text" id="taxId">

    <hr class="line-in-form">

    <label>Credit Score</label>
    <select class="w3-select" id="creditScore">
      <option>-----</option>
      <option>0 = ไม่ดีเลย</option>
      <option>1 = ไม่ค่อยดี</option>
      <option>2 = พอใช้</option>
      <option>3 = ทั่วไป</option>
      <option>4 = ดี</option>
      <option>5 = ดีมาก</option>
    </select>
    <label></label>
    <small>การจัดระดับความน่าเชื่อถือทางการเงิน จาก 0 ไม่มีเลย ไปถึง 5 ดีที่สุด</small>

    <hr class="line-in-form">

    <label>บัญชีธนาคาร 1</label>
    <input type="text" id="bankAccount1" placeholder="เช่น กสิกร/123456">
    <label>บัญชีธนาคาร 2</label>
    <input type="text" id="bankAccount2">
    


    <hr class="line-in-form">

    <label>ผู้ติดต่อด้านการเงิน</label>
    <input type="text" id="financePerson" placeholder="เช่น คุณ กขค/213456">
    <label>ผู้ติดต่อด้านการขาย</label>
    <input type="text" id="salesPerson">
    <label>ผู้ติดต่อด้านการบริการ</label>
    <input type="text" id="servicesPerson">
    <label>ผู้ติดต่อด้านอื่นๆ</label>
    <input type="text" id="otherPerson">

    <hr class="line-in-form">



    <label>Note</label>
    <textarea id="note" rows="4" placeholder="Note ที่เรามีต่อเขา ..."></textarea>
    
    <label>ป้อนข้อมูลโดย*</label>
    <input id="enterBy" type="text" placeholder="เช่น @sern, @john ...">

  </div>

  <!-- action -->
  <div style="display: flex; align-items: center; justify-content: space-around; margin-top: 40px; margin-bottom: 60px;">
    <button class="w3-button w3-blue" 
    onclick="addPartner()">Save</button>
    <button class="w3-button w3-light-grey" 
    onclick="location.reload()">Cancel / Clear</button>
  </div>



</div>



<!-- page action -->
<div style="padding: 4px; position: fixed; left: 0; bottom: 0; ">
  <img src="/icon/u-turn.svg" style="cursor: pointer; width: 32px;" 
  onclick="location.href='/pump/index.html';">
</div>


<script>
///////////////////////////////////////////////////////////////////

// DEFINITION

const domain = PUMP_DOMAIN //'http://192.168.1.111:4000';
const showPicHere = document.getElementById('showPicHere');


//const lastEdit = new Date
//document.getElementById('lastEdit').value = lastEdit





async function fetchThis( data, api ) {
    
  let response = await fetch( domain + api, {
    method  : 'POST',
    headers : {'Content-Type':'application/json'},
    body    : JSON.stringify( data )

  })
  
  return response.json()

}


async function sendData() {
  try {
    let data = {
      facePic: showFacePicHere.src,
      nickName: document.getElementById('nickName').value,
      firstName: document.getElementById('firstName').value,
      lastName: document.getElementById('lastName').value,
      position: document.getElementById('position').value,
      department: document.getElementById('department').value,
      role: document.getElementById('role').value,
      staffCode: document.getElementById('staffCode').value,
      start: document.getElementById('start').value,
      tel: document.getElementById('tel').value,  
      lineId: document.getElementById('lineId').value,
      facebookMessenger: document.getElementById('facebookMessenger').value,
      address: document.getElementById('address').value,

      nationality: document.getElementById('nationality').value,
      citizenId: document.getElementById('citizenId').value,
      sex: document.getElementById('sex').value,
      age: document.getElementById('age').value,
      birthDate: document.getElementById('birthDate').value,


      skills: Array.from( document.querySelectorAll('input[name="skill"]:checked') ).map( el => el.value ),

      workPlace: document.getElementById('workPlace').value,

      wages: document.getElementById('wages').value,
      hiringType: document.getElementById('hiringType').value,

      benefits: Array.from( document.querySelectorAll('input[name="benefit"]:checked') ).map( el => el.value ),

      status: document.getElementById('status').value,
      ref: document.getElementById('ref').value,
      note: document.getElementById('note').value,
      enterBy: document.getElementById('enterBy').value,
      time: Date.now()
    }


    // validate
    if( !data.nickName || !data.firstName || !data.lastName || !data.tel || !data.enterBy ) {
      alert('กรุณากรอกข้อมูลให้ครบถ้วนในช่องที่มีเครื่องหมาย *')
      return
    }


    // pass - basic validation


    let resp = await fetchThis( data, '/add-staff' )
    //alert( JSON.stringify( resp ) )
    alert('เรียบร้อย')
    location.reload()
    document.getElementById('nickName').focus()

  
  } catch( error ) {
    console.error( error )
  }
}






</script>
</body>
</html>