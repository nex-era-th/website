<h2>Upload JPG with Note</h2>

<input type="file" id="fileInput" accept="image/jpeg"><br>
<input type="text" id="noteInput" placeholder="Enter note"><br>
<img id="preview" style="max-width: 300px; display: none;"><br>
<button onclick="upload()">Upload</button>

<script>
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');

fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if (!file || file.type !== 'image/jpeg') {
    alert("Only JPEG files allowed.");
    preview.style.display = 'none';
    return;
  }

  const reader = new FileReader();
  reader.onload = function (e) {
    preview.src = e.target.result;
    preview.style.display = 'block';
  };
  reader.readAsDataURL(file);
});

async function upload() {
  const file = fileInput.files[0];
  const note = document.getElementById('noteInput').value;

  if (!file) return alert("Please select a file.");

  const formData = new FormData();
  formData.append('file', file, file.name || 'upload.jpg');
  formData.append('note', note);

  console.log( file.name, file.type, file.size)

  try {
    const res = await fetch('http://localhost:10000/upload-jpg2', {
      method: 'POST',
      body: formData
    });

    const result = await res.json();
    console.log(result);
    alert("Upload success!");
  } catch (err) {
    console.error(err);
    alert("Upload failed.");
  }
}
</script>
